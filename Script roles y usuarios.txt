{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww33100\viewh17760\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 --Creaci\'f3n del Rol de solo lectura\
CREATE ROLE rol_lectura;\
GRANT SELECT ON ALL TABLES IN SCHEMA agenciadeviajes TO rol_lectura;\
\
-- Creaci\'f3n de Rol de manipulaci\'f3n de datos\
GRANT CONNECT ON DATABASE postgres TO readwrite;\
GRANT USAGE ON SCHEMA agenciadeviajes TO readwrite;\
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA agenciadeviajes TO readwrite;\
ALTER DEFAULT PRIVILEGES IN SCHEMA agenciadeviajes GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO readwrite;\
\
-- Otorgar permisos en todas las secuencias del esquema agenciadeviajes\
DO $$ \
DECLARE\
    seq RECORD;\
BEGIN\
    FOR seq IN\
        SELECT sequence_schema, sequence_name\
        FROM information_schema.sequences\
        WHERE sequence_schema = 'agenciadeviajes'\
    LOOP\
        EXECUTE 'GRANT USAGE, UPDATE ON SEQUENCE ' || quote_ident(seq.sequence_schema) || '.' || quote_ident(seq.sequence_name) || ' TO readwrite';\
    END LOOP;\
END $$;\
\
-- Otorgar permisos predeterminados para tablas futuras\
ALTER DEFAULT PRIVILEGES IN SCHEMA agenciadeviajes\
GRANT INSERT, DELETE, UPDATE, SELECT ON TABLES TO readwrite;\
\
-- Otorgar permisos predeterminados para secuencias futuras\
ALTER DEFAULT PRIVILEGES IN SCHEMA agenciadeviajes\
GRANT USAGE, UPDATE ON SEQUENCES TO readwrite;\
\
--Creaci\'f3n de Usuarios\
\
CREATE USER matheo_oviedo WITH PASSWORD 'P0sTg32-';\
CREATE USER daniel_galiano WITH PASSWORD 'P0sTg32-';\
\
--Asignaci\'f3n de roles\
GRANT readonly TO matheo_oviedo;\
GRANT readwrite TO daniel_galiano;\
\
--Verificar los privilegios que tiene el rol de lectura sobre las tablas\
SELECT grantee, table_name, privilege_type\
FROM information_schema.role_table_grants\
WHERE table_schema = 'agenciadeviajes'\
  AND grantee IN ('readonly');\
\
--Verificar los privilegios que tiene el rol de modifiaci\'f3n sobre las tablas\
SELECT grantee, table_name, privilege_type\
FROM information_schema.role_table_grants\
WHERE table_schema = 'agenciadeviajes'\
  AND grantee IN ('readwrite');\
\
\
------ PRUEBAS DE PRIVILEGIOS EN EL USUARIO readwrite -------\
\
--Insertar datos en la tabla hoteles\
INSERT INTO agenciadeviajes.hoteles (nombre, direccion, ciudad, pais, telefono, precioNoche)\
VALUES ('Hotel Test', '123 Calle Falsa', 'Quito', 'Ecuador', '0987653321', 100);\
\
-- Actualizar datos en la tabla hoteles\
UPDATE agenciadeviajes.hoteles\
SET direccion = '456 Calle Verdadera'\
WHERE nombre = 'Hotel Test';\
\
-- Eliminar datos en la tabla hoteles\
DELETE FROM agenciadeviajes.hoteles\
WHERE nombre = 'Hotel Test';\
\
-- Verificaci\'f3n de datos insertados\
SELECT * FROM agenciadeviajes.hoteles;\
}